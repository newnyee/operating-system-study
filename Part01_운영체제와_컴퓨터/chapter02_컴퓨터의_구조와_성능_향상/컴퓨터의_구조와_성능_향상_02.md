## 03_컴퓨터 성능 향상 기술

- CPU, 메모리, 주변장치의 작업속도는 다름
- 시스템 버스(FSB)와 CPU 내부 버스(BSB)는 속도 차이가 있음.
- 장치간 속도 차이 개선을 위한 기술에 대하여 알아봄

### 버퍼

- 일정량의 데이터를 모아서 옮겨 속도 차이를 완화하는 장치
- HDD에는 메모리 버퍼가 있음. 같은 사양이라면 버퍼 용량이 큰 것이 빠름
- 동영상 스트리밍에도 버퍼가 있음. 
    - 네트워크에서 데이터가 들어오는 시간과 플레이어가 재생하는 시간의 속도 차이 방지를 위해 데이터의 일정부분을 버퍼에 넣은 후 실행함.

### 스풀

- 버퍼와 유사함. CPU와 입출력장치가 독립적으로 동작하도록 고안됨.
- 대표적인 예는 프린터에 사용되는 스풀러. 
- 버퍼는 데이터가 다 차면 이동이 시작됨(메모리 버퍼 사이즈가 고정), 스풀러는 공유하지 않고 독립적으로 단위 구성이됨(HDD 사용)

### 캐시

- 메모리와 CPU 간의 속도 차이 완화를 위해 메모리의 데이터를 미리 가져오는 임시 장소
- 버퍼의 일종임
- 미리 가져오는 작업을 prefetch라 함.
- CPU는 메모리에 접근할 때 캐시를 먼저 방문하여 원하는 데이터가 있는지 찾아봄.
  - 원하는 데이터가 있음 -> cache hit -> 해당 데이터 바로 사용
  - 원하는 데이터가 없음 -> cache miss -> 메모리로 가서 데이터 찾음.
- 캐시의 크기가 커지면 더 많은 데이터를 미리 가져올 수 있어 캐시 적중률이 올라간다.

> 캐시 적중률을 높이기 위한 방법으로 현재 위치에 가까운 데이터를 미리 가져와 두는 방식인 '지역성(locality)' 이론을 따른다.

> 즉시 쓰기
> - 캐시에 있는 데이터 변경시 바로 메모리에 반영.
> - 빈번한 데이터 전송으로 성능이 느려짐. 
> - 최신값이 유지되기에 데이터를 잃지 않음.
> 
> 지연 쓰기
> - 캐시에 있는 데이터를 모아서 주기적으로 반영(copy back)
> - 성능은 향상되나, 메모리와 캐시 간 데이터 불일치가 발생할 수 있음.

캐시의 계층
- L1 : 명령어 캐시, 데이터 캐시. CPU 레지스터에 직접 연결됨.
- L2 : 일반 캐시. 메모리와 연결됨. 명령어, 데이터 관계없이 모든 자료를 가져옴.

### 인터럽트

- CPU가 직접 입출력장치에서 데이터를 가져오거나 내보냈던 polling 방식을 개선함.
- CPU의 작업과 저장장치의 데이터 이동을 독립적으로 운영함으로써 효율을 높인다. 
- 입출력 관리자가 작업이 완료되면 CPU에 완료신호를 보내는 것
- 인터럽트 발생시 context switching이 발생하여 임시 저장 공간에 현재 작업 내용을 옮겨 두고 인터럽트 상황을 해결한 후에 다시 이전 작업을 수행함.
- 여러 개의 입출력 작업을 동시에 시키면서 인터럽트를 여러 번 사용하는 비효율을 개선하기 위해 인터럽트 배열인 '인터럽트 벡터'를 사용한다.

### 직접 메모리 접근 (DMA)

- CPU가 일을 시킨 입출력 관리자가 요청받은 데이터를 메모리에 이동시켜야 하는데 권한 이 없음.
- 입출력 관리자는 CPU의 허락없이 메모리에 접근할 수 있는 권한이 필요함.

### 메모리 맵 입출력

- DMA를 사용시 메모리에 CPU가 사용하는 데이터와 입출력장치가 사용하는 데이터가 혼재될 수 있음.
- 관리가 용이하게 되게 하기 위해 메모리를 CPU와 DMA 데이터를 위한 공간을 분리했음.
- 메모리는 OS, CPU, I/O 작업 영역으로 나눠짐.
- 동시에 메모리에 접근하는 경우는 작업속도가 느린 입출력장치에게 양보하면서 순서를 빼앗김(cycle stealing)



## 04_멀티 프로세싱

### 멀티 코어 시스템

- 프로세서를 여러 개 설치하여 사용하는 시스템을 '멀티 프로세서 시스템'이라 부름
- 기존 시스템을 유지한 채 멀티 프로세싱을 할 수 있게 하는 시스템이 '멀티 코어 시스템'
- 하나의 칩에 CPU의 핵심이 되는 코어를 여러개 만들어 여러 작업을 동시에 처리 가능.

### CPU 멀티스레드

- 하나의 코어에서 2개 이상의 명령어를 처리하는 방법 = '명령어 병렬 처리'
  - 인텔에서 만든 hyper thread를 이용해 코어가 2개 있는 것 처럼 2개의 명령어를 거의 동시에 실행함.
- 하나의 코어에 여러개의 스레드를 이용하는 방식 = '멀티 스레드'
- 4코어의 PC는 논리 프로세서의 개수가 8개가 되어 진다.
